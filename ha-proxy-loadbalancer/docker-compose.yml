version: '3.8'
services:

  haproxy:
    image: haproxy:2.7
    deploy:
      placement:
        constraints:
          - node.platform.os == linux
          - node.role == manager
          - node.labels.type == proxy
    networks:
      - alphanetwork
    ports:
      - 48161:48161
      - 48162:48162
      - 40001:40001
      - 40002:40002
      - 40003:40003
#      Add more ports for load balancing
    volumes:
#      save  haproxy.cfg at /opt/haproxy/ host machine, in case of multiple workers, nfs must be implemented.
      - /opt/haproxy/:/usr/local/etc/haproxy/:ro

networks:
  alphanetwork:
    driver: overlay
    attachable: true
